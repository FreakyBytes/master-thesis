% !TeX spellcheck = en_GB
Using the concepts described in Chapter~\ref{sec:concept}, a prototype was implemented to validate, test and proof it which is described in Chapter~\ref{sec:impl}.
In this Chapter this implementation shall be used to conduct a performance experiment on the implementation itself and the used algorithms.
For which first the experiment setup is described.

\section{Conducting the Performance Experiment}
\label{sec:results:experiment}

The in this thesis proposed concept for an online anomaly-based \gls{ids} tailored to \glspl{bas} was implemented as prototype, as described in Chapter~\ref{sec:impl}.
Using this prototype a full analysis pipeline was setup, which included the Collector, all four Analyser modules, and the Simulated Agent, as well as \gls{rabbitmq} as message broker and \gls{influxdb} as persistent data storage.
The Simulated Agent was used to inject prior recorded traffic into the system faster than real time.
The data was originally recorded between 2017-01-21 and 2017-02-21 on the third floor of the computer science building of the University Rostock.
Before injecting and analysing the data, it was then split into three parts. The first two weeks are dedicated to train the base-line models for the Analyser modules. The following week was used as validation, to ensure the algorithms are properly fitted to the data. Finally, the last week was modified to contain four scenarios which alter the behaviour of the line, as described in Section~\ref{sec:methods:gen-test}.
\newpage
These modifications are meant to resemble plausible attacks on \gls{bas} networks and therefore include:

\begin{enumerate}
	\item Injecting unusual network traffic by copying traffic from another day and time
	\item Performing a \gls{dos} attack
	\item Scanning all addresses of the network
	\item Introducing two new devices
\end{enumerate}

First, only the training data was imported via the Simulated Agent and pushed to the \gls{influxdb} by the Collector. This data was then used to train the different algorithms.
Then the remaining two parts of data set were imported via the Simulated Agent and processed into statistical windows, these were then processed by the Collector, and relayed to the analytical modules. Finally, the Analyser compare the incoming windows to the base-line model and store the result in the \gls{influxdb}. From there the monitoring and alerting software \gls{grafana} can query the results and plot them into dynamic graphs, as well as send alerts based on predefined thresholds or rules.

\section{Experiment Results}
\label{sec:results:results}

Finally, in this section the detection results of the proposed algorithms are examined using the graphs generated with \gls{grafana}. They will be used to determine the quality of the detection results based on five criteria:

\begin{enumerate}
	\item General ability to the detect the attack
	\item Differentiation from background noise of the detection results
	\begin{enumerate}
		\item Average difference in detected outliers
		\item Average difference in underlying decision metric
	\end{enumerate}
	\item Response time 
	\item Persistence of detection
\end{enumerate}

\subsection{Detection of Unusual Network Traffic}
\label{sec:results:results:unusual}

The first modification applied to the test data set was the injection of unusual traffic. 
For this a time span of five hours was replaced with traffic from the same line, but from different weekday and time of the day.
This effectively aims to test the seasonal- or time-sensitivity of the models.

Figure~\ref{fig:results:unusual} shows several metrics from the four different anomaly detection methods.
In \ref{fig:results:unusual:tc} a sudden increase in the observed amounts of telegrams per window is to observe, whereby telegrams with using unknown addresses were observed. This is to be expected since the five hours which replaced the original traffic were taken from the same line but from a more busy point of the week, hence the increase of transmitted telegrams.
The absence of unknown addresses, either as source or as destination, is also clearly indicated by Figure~\ref{fig:results:unusual:addr}.

Surprisingly, there is also no significant increase in the number of detected outliers neither by the \gls{svm}, nor using the \gls{lof}, as shown in Figure~\ref{fig:results:unusual:outlier}.
Even though the \gls{lof} shows an average of $0.77$ outliers, it can hardly be considered an significant increase when compared to the surrounding unmodified data and to the validation data set in Appendix~\ref{app:metrics:validation}.
However, the spread of the Local Outlier Factor depicted in Figure~\ref{fig:results:unusual:lof} shows a small change downwards, which indicates less normal behaviour -- it is arguably not significant enough.

In contrast, Figure~\ref{fig:results:unusual:svm} even shows that the distance to the decision function of the \gls{svm} even increases positively, which means the analysed points are considered to represent the normality stronger. This is also reflected in the detection of no outliers with the exception of two small peaks.

The Entropy Analyser mostly calculates a entropy of infinity, which is here encoded as $100000$. This results is not limited to the period of the modification and therefore renders its results relatively meaningless.

\begin{figure}[H]
	\newcommand{\figwith}{0.49\textwidth}
	\newcommand{\figprefix}{unusual}
	\centering
	
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-tc.png}
		\caption{Telegrams (green) and telegrams with unknown addresses (yellow) over time}
		\label{fig:results:\figprefix:tc}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-unknown-addr.png}
		\caption{Amount of observed unknown source (green) and destination (yellow) addresses}
		\label{fig:results:\figprefix:addr}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-num-outliers.png}
		\caption{Number of detected outliers via SVM (red) and LOF (blue).}
		\label{fig:results:\figprefix:outlier}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-entropy.png}
		\caption{Calculated Entropy over time, infinity is encoded as $100 000$}
		\label{fig:results:\figprefix:entropy}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-lof-spread.png}
		\caption{Spread and average of the Local Outlier Factor, smaller numbers indicate outlier}
		\label{fig:results:\figprefix:lof}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-svm-spread.png}
		\caption{Spread and average of the distance to decision surface, negative distances are outlier}
		\label{fig:results:\figprefix:svm}
	\end{subfigure}
	
	\caption[Detection Results of Unusual Network Traffic]{Detection Results of Unusual Network Traffic from 2017-02-12 02:00 to 09:00 with a minimal time resolution of 2 minutes. The modified time range is marked as a grey box.}
	\label{fig:results:\figprefix}
	
\end{figure}

\begin{table}[H]
	\aboverulesep=0ex
	\belowrulesep=0ex
	\renewcommand{\arraystretch}{1.2}
	\newcolumntype{Y}{>{\centering\arraybackslash}X}
	
	\centering
	\begin{tabularx}{0.95\textwidth}{|l|Y|Y|Y|Y|}
		\toprule
		& \gls{lof} & \gls{svm} & Address & Entropy \\\midrule
		1. Attack detected & no & no & no & no \\\midrule
		2.a) Avg. difference in outliers  & $0.319$ & $0.013$ & 0 & n/a \\\midrule
		2.b) Avg. difference in metric & $2.65$ & $5.42$ & n/a & n/a \\\midrule
		3. Response time & 0s & 0s & n/a & n/a \\\midrule
		4. Persistence & n/a & n/a & n/a & n/a \\\bottomrule
	\end{tabularx}
	\caption[Detection results of unusual traffic]{Detection results of unusual traffic. Averages are compared to the validation dataset.}
	\label{tab:results:unusual}
\end{table}

\subsection{Detection of a DoS Attack}
\label{sec:results:results:dos}

\begin{figure}[H]
	\newcommand{\figwith}{0.49\textwidth}
	\newcommand{\figprefix}{dos}
	\centering
	
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-tc.png}
		\caption{Telegrams (green) and telegrams with unknown addresses (yellow) over time}
		\label{fig:results:\figprefix:tc}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-unknown-addr.png}
		\caption{Amount of observed unknown source (green) and destination (yellow) addresses}
		\label{fig:results:\figprefix:addr}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-num-outliers.png}
		\caption{Number of detected outliers via SVM (red) and LOF (blue).}
		\label{fig:results:\figprefix:outlier}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-entropy.png}
		\caption{Calculated Entropy over time, infinity is encoded as $100 000$}
		\label{fig:results:\figprefix:entropy}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-lof-spread.png}
		\caption{Spread and average of the Local Outlier Factor, smaller numbers indicate outlier}
		\label{fig:results:\figprefix:lof}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-svm-spread.png}
		\caption{Spread and average of the distance to decision surface, negative distances are outlier}
		\label{fig:results:\figprefix:svm}
	\end{subfigure}
	
	\caption[Detection Results of a DoS]{Detection Results DoS attack from 2017-02-13 08:40 to 09:50 with a minimal time resolution of 2 minutes. The time range of the attack is marked as a grey box.}
	\label{fig:results:\figprefix}
	
\end{figure}

\begin{table}[H]
	\aboverulesep=0ex
	\belowrulesep=0ex
	\renewcommand{\arraystretch}{1.2}
	\newcolumntype{Y}{>{\centering\arraybackslash}X}
	
	\centering
	\begin{tabularx}{0.95\textwidth}{|l|Y|Y|Y|Y|}
		\toprule
		& \gls{lof} & \gls{svm} & Address & Entropy \\\midrule
		1. Attack detected & yes & yes & yes & no \\\midrule
		2.a) Avg. difference in outliers  & n/a & n/a & n/a & n/a \\\midrule
		2.b) Avg. difference in metric & n/a & n/a & n/a & n/a \\\midrule
		3. Response time & n/a & n/a & n/a & n/a \\\midrule
		4. Persistence & n/a & n/a & n/a & n/a \\\bottomrule
	\end{tabularx}
	\caption[Detection results of the DoS attack]{Detection results of the \gls{dos} attack.}
	\label{tab:results:dos}
\end{table}

\subsection{Detection of a Network Scan}
\label{sec:results:results:scan}

\begin{figure}[H]
	\newcommand{\figwith}{0.49\textwidth}
	\newcommand{\figprefix}{scan}
	\centering
	
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-tc.png}
		\caption{Telegrams (green) and telegrams with unknown addresses (yellow) over time}
		\label{fig:results:\figprefix:tc}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-unknown-addr.png}
		\caption{Amount of observed unknown source (green) and destination (yellow) addresses}
		\label{fig:results:\figprefix:addr}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-num-outliers.png}
		\caption{Number of detected outliers via SVM (red) and LOF (blue).}
		\label{fig:results:\figprefix:outlier}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-entropy.png}
		\caption{Calculated Entropy over time, infinity is encoded as $100 000$}
		\label{fig:results:\figprefix:entropy}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-lof-spread.png}
		\caption{Spread and average of the Local Outlier Factor, smaller numbers indicate outlier}
		\label{fig:results:\figprefix:lof}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-svm-spread.png}
		\caption{Spread and average of the distance to decision surface, negative distances are outlier}
		\label{fig:results:\figprefix:svm}
	\end{subfigure}
	
	\caption[Detection Results of a Network Scan]{Detection Results of Network Scan from 2017-02-13 20:45 to 21:17 with a minimal time resolution of 30 seconds. The time range of the attack is marked as a grey box.}
	\label{fig:results:\figprefix}
	
\end{figure}

\begin{table}[H]
	\aboverulesep=0ex
	\belowrulesep=0ex
	\renewcommand{\arraystretch}{1.2}
	\newcolumntype{Y}{>{\centering\arraybackslash}X}
	
	\centering
	\begin{tabularx}{0.95\textwidth}{|l|Y|Y|Y|Y|}
		\toprule
		& \gls{lof} & \gls{svm} & Address & Entropy \\\midrule
		1. Attack detected & yes & yes & yes & no \\\midrule
		2.a) Avg. difference in outliers  & n/a & n/a & n/a & n/a \\\midrule
		2.b) Avg. difference in metric & n/a & n/a & n/a & n/a \\\midrule
		3. Response time & n/a & n/a & n/a & n/a \\\midrule
		4. Persistence & n/a & n/a & n/a & n/a \\\bottomrule
	\end{tabularx}
	\caption[Detection results of the network scan]{Detection results of the network scan.}
	\label{tab:results:scan}
\end{table}

\subsection{Detection of New Devices}
\label{sec:results:results:newdevice}

\begin{figure}[H]
	\newcommand{\figwith}{0.49\textwidth}
	\newcommand{\figprefix}{newdevice}
	\centering
	
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-tc.png}
		\caption{Telegrams (green) and telegrams with unknown addresses (yellow) over time}
		\label{fig:results:\figprefix:tc}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-unknown-addr.png}
		\caption{Amount of observed unknown source (green) and destination (yellow) addresses}
		\label{fig:results:\figprefix:addr}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-num-outliers.png}
		\caption{Number of detected outliers via SVM (red) and LOF (blue).}
		\label{fig:results:\figprefix:outlier}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-entropy.png}
		\caption{Calculated Entropy over time, infinity is encoded as $100 000$}
		\label{fig:results:\figprefix:entropy}
	\end{subfigure}
	\\[1.5mm]
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-lof-spread.png}
		\caption{Spread and average of the Local Outlier Factor, smaller numbers indicate outlier}
		\label{fig:results:\figprefix:lof}
	\end{subfigure}
	\hfil
	\begin{subfigure}[b]{\figwith}
		\includegraphics[width=\textwidth]{figures/700-results/\figprefix-svm-spread.png}
		\caption{Spread and average of the distance to decision surface, negative distances are outlier}
		\label{fig:results:\figprefix:svm}
	\end{subfigure}
	
	\caption[Detection Results of New Devices]{Detection Results of New Devices from 2017-02-13 23:00 to 2017-02-15 01:00 with a minimal time resolution of 10 minutes. The time range of the modification is marked as a grey box.}
	\label{fig:results:\figprefix}
	
\end{figure}

\begin{table}[H]
	\aboverulesep=0ex
	\belowrulesep=0ex
	\renewcommand{\arraystretch}{1.2}
	\newcolumntype{Y}{>{\centering\arraybackslash}X}
	
	\centering
	\begin{tabularx}{0.95\textwidth}{|l|Y|Y|Y|Y|}
		\toprule
		& \gls{lof} & \gls{svm} & Address & Entropy \\\midrule
		1. Attack detected &  &  &  & no \\\midrule
		2.a) Avg. difference in outliers  & n/a & n/a & n/a & n/a \\\midrule
		2.b) Avg. difference in metric & n/a & n/a & n/a & n/a \\\midrule
		3. Response time & n/a & n/a & n/a & n/a \\\midrule
		4. Persistence & n/a & n/a & n/a & n/a \\\bottomrule
	\end{tabularx}
	\caption[Detection results of new devices]{Detection results of two new devices in the network.}
	\label{tab:results:newdevice}
\end{table}

\section{Conclusion}
\label{sec:results:conclusion}

\begin{table}[H]
	\aboverulesep=0ex
	\belowrulesep=0ex
	\renewcommand{\arraystretch}{1.2}
	\newcolumntype{Y}{>{\centering\arraybackslash}X}
	
	\centering
	\begin{tabularx}{0.95\textwidth}{|l|Y|Y|Y|Y|}
		\toprule
		& \gls{lof} & \gls{svm} & Address & Entropy \\\midrule
		Unusual traffic & no & no & no & no \\\midrule
		\gls{dos} attack & yes & yes & yes & no \\\midrule
		Network Scan & yes & yes & yes & no \\\midrule
		New Devices &  &  &  & no \\\midrule
	\end{tabularx}
	\caption[Detection results of new devices]{Detection results of two new devices in the network.}
	\label{tab:results:conclusion}
\end{table}
